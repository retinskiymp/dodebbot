from typing import Dict, Tuple
from telegram import Update, InlineKeyboardButton, InlineKeyboardMarkup
from telegram.ext import ContextTypes, CommandHandler, CallbackQueryHandler

from handlers import HandlerBlackJack, HandlerWiki  # —Ç–≤–æ–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∫–∏ —Å long/short
from items import ItemId, ITEMS

BLACK_JACK_RULES = """
‚ô†Ô∏è‚ô•Ô∏è‚ô¶Ô∏è‚ô£Ô∏è –ü—Ä–∞–≤–∏–ª–∞ –∏–≥—Ä—ã –≤ –ë–ª—ç–∫–¥–∂–µ–∫ ‚ô£Ô∏è‚ô¶Ô∏è‚ô•Ô∏è‚ô†Ô∏è

üéØ 1. –¶–µ–ª—å –∏–≥—Ä—ã
–ù–∞–±—Ä–∞—Ç—å —Å—É–º–º—É –æ—á–∫–æ–≤ –∫–∞–∫ –º–æ–∂–Ω–æ –±–ª–∏–∂–µ –∫ 21, –Ω–µ –ø—Ä–µ–≤—ã—à–∞—è –µ–≥–æ.
–¢—É–∑ (A) –º–æ–∂–µ—Ç —Å—Ç–æ–∏—Ç—å 1 –∏–ª–∏ 11 –æ—á–∫–æ–≤ ‚Äî –∑–Ω–∞—á–µ–Ω–∏–µ –≤—ã–±–∏—Ä–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ç–∞–∫,
—á—Ç–æ–±—ã —Ä—É–∫–∞ –±—ã–ª–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –≤—ã–≥–æ–¥–Ω–æ–π, –Ω–æ –Ω–µ –ø—Ä–µ–≤—ã—Å–∏–ª–∞ 21.
–ö–∞—Ä—Ç–∏–Ω–∫–∏ (J, Q, K) = 10 –æ—á–∫–æ–≤.
–û—Å—Ç–∞–ª—å–Ω—ã–µ –∫–∞—Ä—Ç—ã ‚Äî –ø–æ –Ω–æ–º–∏–Ω–∞–ª—É.
"–ë–ª—ç–∫–¥–∂–µ–∫" = —Ç—É–∑ + –∫–∞—Ä—Ç–∞ –Ω–∞ 10 –æ—á–∫–æ–≤ —Å –ø–µ—Ä–≤—ã—Ö –¥–≤—É—Ö –∫–∞—Ä—Ç.

üÉè 2. –†–∞–∑–¥–∞—á–∞ –∫–∞—Ä—Ç
–ö–∞–∂–¥—ã–π –∏–≥—Ä–æ–∫ –∏ –¥–∏–ª–µ—Ä –ø–æ–ª—É—á–∞—é—Ç –ø–æ 2 –∫–∞—Ä—Ç—ã.
–ö–∞—Ä—Ç—ã –∏–≥—Ä–æ–∫–∞ –æ—Ç–∫—Ä—ã—Ç—ã, —É –¥–∏–ª–µ—Ä–∞ –æ–¥–Ω–∞ –æ—Ç–∫—Ä—ã—Ç–∞, –≤—Ç–æ—Ä–∞—è –∑–∞–∫—Ä—ã—Ç–∞.
–ò–≥—Ä–æ–∫–∏ —Ö–æ–¥—è—Ç –ø–æ –æ—á–µ—Ä–µ–¥–∏ —Å–≤–µ—Ä—Ö—É –≤–Ω–∏–∑, –∞–∫—Ç–∏–≤–Ω—ã–π –∏–≥—Ä–æ–∫ –æ—Ç–º–µ—á–µ–Ω ¬´üî∏¬ª.

üéÆ 3. –î–µ–π—Å—Ç–≤–∏—è –∏–≥—Ä–æ–∫–∞
üïπÔ∏è –í–∑—è—Ç—å –∫–∞—Ä—Ç—É (Hit) ‚Äî –ø–æ–ª—É—á–∏—Ç—å –µ—â—ë –æ–¥–Ω—É –∫–∞—Ä—Ç—É.
üöóüí® –•–≤–∞—Ç–∏—Ç (Stand) ‚Äî –∑–∞–≤–µ—Ä—à–∏—Ç—å —Ö–æ–¥, –æ—Å—Ç–∞–≤–∏—Ç—å —Ç–µ–∫—É—â–∏–µ –∫–∞—Ä—Ç—ã.
üöÄ –£–¥–≤–æ–∏—Ç—å (Double) ‚Äî —É–¥–≤–æ–∏—Ç—å —Å—Ç–∞–≤–∫—É, –≤–∑—è—Ç—å —Ä–æ–≤–Ω–æ –æ–¥–Ω—É –∫–∞—Ä—Ç—É –∏ –∑–∞–≤–µ—Ä—à–∏—Ç—å —Ö–æ–¥. –î–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ –Ω–∞ –ø–µ—Ä–≤—ã—Ö –¥–≤—É—Ö –∫–∞—Ä—Ç–∞—Ö –∏ –ø—Ä–∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–º –±–∞–ª–∞–Ω—Å–µ.
‚úÇÔ∏è –†–∞–∑–¥–µ–ª–∏—Ç—å (Split) ‚Äî –µ—Å–ª–∏ –¥–≤–µ –ø–µ—Ä–≤—ã–µ –∫–∞—Ä—Ç—ã –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ, –º–æ–∂–Ω–æ —Ä–∞–∑–¥–µ–ª–∏—Ç—å –∏—Ö –Ω–∞ –¥–≤–µ —Ä—É–∫–∏, –¥–æ–±–∞–≤–∏–≤ —Å—Ç–∞–≤–∫—É –Ω–∞ –≤—Ç–æ—Ä—É—é. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ ‚Äî –Ω–µ –±–æ–ª–µ–µ 3 —Å–ø–ª–∏—Ç–æ–≤.

ü§µ 4. –î–∏–ª–µ—Ä
–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ö–æ–¥–æ–≤ –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤ –¥–∏–ª–µ—Ä –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –≤—Ç–æ—Ä—É—é –∫–∞—Ä—Ç—É.
–ë–µ—Ä—ë—Ç –∫–∞—Ä—Ç—ã, –ø–æ–∫–∞ –Ω–µ –Ω–∞–±–µ—Ä—ë—Ç –º–∏–Ω–∏–º—É–º 17 –æ—á–∫–æ–≤.
–ù–∞ 17 (–≤–∫–ª—é—á–∞—è ¬´–º—è–≥–∫–∏–µ¬ª 17 —Å —Ç—É–∑–æ–º) –¥–∏–ª–µ—Ä –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è.

üèÜ 5. –í—ã–∏–≥—Ä—ã—à –∏ –ø—Ä–æ–∏–≥—Ä—ã—à
>21: –ø–µ—Ä–µ–±–æ—Ä, –∏–≥—Ä–æ–∫ –ø—Ä–æ–∏–≥—Ä—ã–≤–∞–µ—Ç.
–î–∏–ª–µ—Ä >21: –≤—ã–∏–≥—Ä—ã–≤–∞—é—Ç –≤—Å–µ –æ—Å—Ç–∞–≤—à–∏–µ—Å—è –∏–≥—Ä–æ–∫–∏.
–ë–ª—ç–∫–¥–∂–µ–∫ (–∏–≥—Ä–æ–∫) –ø–æ–±–µ–∂–¥–∞–µ—Ç –æ–±—ã—á–Ω—ã–µ 21 –¥–∏–ª–µ—Ä–∞ (>2 –∫–∞—Ä—Ç) –∏ –∏–≥—Ä–æ–∫—É –≤—ã–ø–ª–∞—á–∏–≤–∞–µ—Ç—Å—è 3:2.
–ï—Å–ª–∏ —É –¥–∏–ª–µ—Ä–∞ –±–ª—ç–∫–¥–∂–µ–∫, –∞ —É –∏–≥—Ä–æ–∫–∞ –Ω–µ—Ç ‚Äî –ø—Ä–æ–∏–≥—Ä—ã—à.
–ï—Å–ª–∏ —Å—É–º–º—ã —Ä–∞–≤–Ω—ã ‚Äî –Ω–∏—á—å—è (Push), —Å—Ç–∞–≤–∫–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è.
"""

DOUBLE_DESC = """
üöÄ –£–¥–≤–æ–∏—Ç—å (Double)

–£–¥–≤–∞–∏–≤–∞–µ—Ç —Å—Ç–∞–≤–∫—É —Ä—É–∫–∏, –≤—ã–¥–∞—ë—Ç—Å—è —Ä–æ–≤–Ω–æ –æ–¥–Ω–∞ –∫–∞—Ä—Ç–∞, –∏ —Ö–æ–¥ —ç—Ç–æ–π —Ä—É–∫–∏ —Å—Ä–∞–∑—É –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è.  
–î–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ 2 –∫–∞—Ä—Ç–∞—Ö –≤ —Ä—É–∫–µ –∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–º –±–∞–ª–∞–Ω—Å–µ –¥–ª—è –≤—Ç–æ—Ä–æ–π —Å—Ç–∞–≤–∫–∏.    

–ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏ –ø–æ—Å–ª–µ —Å–ø–ª–∏—Ç–∞.

–ü—Ä–∏–º–µ—Ä:
–£ —Ç–µ–±—è 9‚ô† –∏ 2‚ô• (11 –æ—á–∫–æ–≤), —Å—Ç–∞–≤–∫–∞ 100.  
–ñ–º—ë—à—å ¬´–£–¥–≤–æ–∏—Ç—å¬ª, —Å—Ç–∞–≤–∫–∞ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è 200, —Å –±–∞–ª–∞–Ω—Å–∞ —Å–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –µ—â—ë 100.  
–ü–æ–ª—É—á–∞–µ—à—å 10‚ô¶ ‚Üí –≤—Å–µ–≥–æ 21 –æ—á–∫–æ, –∏ —Ö–æ–¥ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è.
"""

SPLIT_DESC = """
‚úÇÔ∏è –†–∞–∑–¥–µ–ª–∏—Ç—å (Split)

–î–µ–ª–∏—Ç —Ä—É–∫—É –Ω–∞ –¥–≤–µ, –µ—Å–ª–∏ –ø–µ—Ä–≤—ã–µ –¥–≤–µ –∫–∞—Ä—Ç—ã –æ–¥–Ω–æ–≥–æ —Ä–∞–Ω–≥–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, K‚ô† –∏ K‚ô¶, –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç 10‚ô† –∏ K‚ô¶).  
–° –±–∞–ª–∞–Ω—Å–∞ —Å–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤—Ç–æ—Ä–∞—è —Å—Ç–∞–≤–∫–∞ —Ç–∞–∫–æ–≥–æ –∂–µ —Ä–∞–∑–º–µ—Ä–∞. –ö–∞–∂–¥–∞—è –Ω–æ–≤–∞—è —Ä—É–∫–∞ –ø–æ–ª—É—á–∞–µ—Ç –ø–æ –æ–¥–Ω–æ–π –∫–∞—Ä—Ç–µ –∏ –∏–≥—Ä–∞–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ.  

–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
–ú–∞–∫—Å–∏–º—É–º 3 —Å–ø–ª–∏—Ç–∞ –∑–∞ —Ä–∞–∑–¥–∞—á—É.  
–ö–∞–∂–¥–∞—è —Ä—É–∫–∞ —Å—á–∏—Ç–∞–µ—Ç—Å—è –∏ –æ–ø–ª–∞—á–∏–≤–∞–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ.  
–ü–æ—Å–ª–µ —Å–ø–ª–∏—Ç–∞ –º–æ–∂–Ω–æ —É–¥–≤–∞–∏–≤–∞—Ç—å –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–µ–¥–º–µ—Ç—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å—Ç—Ä–∞—Ö–æ–≤–∫—É).

–ü—Ä–∏–º–µ—Ä:
–£ —Ç–µ–±—è 8‚ô£ –∏ 8‚ô•, —Å—Ç–∞–≤–∫–∞ 200.  
–ñ–º—ë—à—å ¬´–†–∞–∑–¥–µ–ª–∏—Ç—å¬ª ‚Üí –¥–≤–µ —Ä—É–∫–∏:  
1Ô∏è‚É£ name 8‚ô£ + A‚ô¶ 
2Ô∏è‚É£ name (‚úÇÔ∏è) 8‚ô• + 3‚ô† 
–° –±–∞–ª–∞–Ω—Å–∞ —Å–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –µ—â—ë 200 –Ω–∞ –≤—Ç–æ—Ä—É—é —Ä—É–∫—É.
–î–ª—è –∫–∞–∂–¥–æ–π —Ä—É–∫–∏ –∏–≥—Ä–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ, –∫–∞–∫ –æ–±—ã—á–Ω–æ.
"""

INSURANCE_DESC = f"""
{ITEMS[ItemId.Insurance].name} <{ITEMS[ItemId.Insurance].id_short_name}>

–ß—Ç–æ —ç—Ç–æ
–†–∞–∑–æ–≤—ã–π —Ç–∞–ª–æ–Ω, –ø–æ–∑–≤–æ–ª—è—é—â–∏–π –∫—É–ø–∏—Ç—å —Å—Ç—Ä–∞—Ö–æ–≤–∫—É –≤ –±–ª—ç–∫–¥–∂–µ–∫–µ, –µ—Å–ª–∏ —É –¥–∏–ª–µ—Ä–∞ –ø–µ—Ä–≤–∞—è –∫–∞—Ä—Ç–∞ ‚Äî —Ç—É–∑.

–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç
‚Äî –ù—É–∂–µ–Ω –ø—Ä–µ–¥–º–µ—Ç ¬´{ITEMS[ItemId.Insurance].name}¬ª –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä–µ.  
‚Äî –ö–Ω–æ–ø–∫–∞ —Å—Ç—Ä–∞—Ö–æ–≤–∫–∏ –ø–æ—è–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ 2 –∫–∞—Ä—Ç–∞—Ö –≤ —Ä—É–∫–µ –∏ —Ç—É–∑–µ —É –¥–∏–ª–µ—Ä–∞.  
‚Äî –°—Ç–æ–∏–º–æ—Å—Ç—å: —Å—Ç–∞–≤–∫–∞ / 2, —Å–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è —Å –±–∞–ª–∞–Ω—Å–∞ –∏ —Ä–∞—Å—Ö–æ–¥—É–µ—Ç—Å—è 1 —Ç–∞–ª–æ–Ω.  
‚Äî –ï—Å–ª–∏ —É –¥–∏–ª–µ—Ä–∞ –Ω–∞—Ç—É—Ä–∞–ª—å–Ω—ã–π –±–ª—ç–∫–¥–∂–µ–∫: –≤—ã–ø–ª–∞—Ç–∞ 2:1 –ø–æ —Å—Ç—Ä–∞—Ö–æ–≤–∫–µ.  
‚Äî –ï—Å–ª–∏ –±–ª—ç–∫–¥–∂–µ–∫–∞ —É –¥–∏–ª–µ—Ä–∞ –Ω–µ—Ç: —Å—Ç—Ä–∞—Ö–æ–≤–∞—è —Å—Ç–∞–≤–∫–∞ —Å–≥–æ—Ä–∞–µ—Ç.  
‚Äî –°—Ç—Ä–∞—Ö–æ–≤–∫–∞ –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ –∏—Å—Ö–æ–¥ –æ—Å–Ω–æ–≤–Ω–æ–π —Ä—É–∫–∏; –æ–Ω–∞ —Å—á–∏—Ç–∞–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ.

–ü—Ä–∏–º–µ—Ä:
–ü–æ—Å—Ç–∞–≤–ª–µ–Ω–æ 100 –º–æ–Ω–µ—Ç, —É –¥–∏–ª–µ—Ä–∞ —Ç—É–∑.  
–í –∏–Ω–≤–µ–Ω—Ç–∞—Ä–µ –µ—Å—Ç—å —Å—Ç—Ä–∞—Ö–æ–≤–∫–∞ ‚Üí –ø–æ—è–≤–ª—è–µ—Ç—Å—è –∫–Ω–æ–ø–∫–∞ ¬´{ITEMS[ItemId.Insurance].name}¬ª.  
–ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –∫–Ω–æ–ø–∫–∏ —Å –±–∞–ª–∞–Ω—Å–∞ —Å–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è 50 –º–æ–Ω–µ—Ç –∏ —Ç—Ä–∞—Ç–∏—Ç—Å—è 1 —Ç–∞–ª–æ–Ω.  
–ï—Å–ª–∏ —É –¥–∏–ª–µ—Ä–∞ –±–ª—ç–∫–¥–∂–µ–∫ ‚Üí –ø–æ–ª—É—á–µ–Ω–∏–µ 150-–∏ –º–æ–Ω–µ—Ç –ø–æ —Å—Ç—Ä–∞—Ö–æ–≤–∫–µ (–≤—ã–∏–≥—Ä—ã—à 100 + –≤–æ–∑–≤—Ä–∞—Ç 50).  
–ï—Å–ª–∏ –Ω–µ—Ç ‚Üí –ø—Ä–æ–∏–≥—Ä—ã—à 50 –º–æ–Ω–µ—Ç –∑–∞ —Å—Ç—Ä–∞—Ö–æ–≤–∫—É.
"""

HOTCARD_DESC = f"""
{ITEMS[ItemId.HotCard].name} <{ITEMS[ItemId.HotCard].id_short_name}>

–ß—Ç–æ —ç—Ç–æ
–û–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–π –ø—Ä–µ–¥–º–µ—Ç-–ø–æ–¥—Å–∫–∞–∑–∫–∞: –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –±–ª–∏–∂–∞–π—à–∏—Ö –∫–∞—Ä—Ç –≤ –∫–æ–ª–æ–¥–µ –∏ –ø–æ–¥—Å–∫–∞–∑—ã–≤–∞–µ—Ç, —á–µ–≥–æ –±–æ–ª—å—à–µ ‚Äî –≤—ã—Å–æ–∫–∏—Ö –∏–ª–∏ –Ω–∏–∑–∫–∏—Ö.

–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç
‚Äî –†–∞—Å—Ö–æ–¥—É–µ—Ç 1 ¬´{ITEMS[ItemId.HotCard].name}¬ª.  
‚Äî –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –±–ª–∏–∂–∞–π—à–∏–µ –∫–∞—Ä—Ç—ã –≤ –∫–æ–ª–æ–¥–µ (–±–µ–∑ —Ä–∞—Å–∫—Ä—ã—Ç–∏—è —Å–∞–º–∏—Ö –∫–∞—Ä—Ç).  
‚Äî –î–∞—ë—Ç –ø–æ–¥—Å–∫–∞–∑–∫—É:
   ‚Ä¢ üî• ¬´–°—Ç–∞—Ä—à–∏–µ –≤–ø–µ—Ä–µ–¥–∏¬ª (10, J, Q, K, A –±–æ–ª—å—à–µ)  
   ‚Ä¢ ‚ùÑÔ∏è ¬´–ú–ª–∞–¥—à–∏–µ –≤–ø–µ—Ä–µ–¥–∏¬ª (2‚Äì9 –±–æ–ª—å—à–µ)  
   ‚Ä¢ ‚öñÔ∏è ¬´–ë–∞–ª–∞–Ω—Å/–Ω–µ—Ç —è–≤–Ω–æ–≥–æ –ø–µ—Ä–µ–≤–µ—Å–∞¬ª
‚Äî –≠—Ç–æ —Ç–æ–ª—å–∫–æ –æ—Ä–∏–µ–Ω—Ç–∏—Ä; —à–∞–Ω—Å—ã, –Ω–µ –≥–∞—Ä–∞–Ω—Ç–∏—è –∏—Å—Ö–æ–¥–∞.
"""

ALIAS_BJ = (HandlerBlackJack.long, HandlerBlackJack.short)
ALIAS_DOUBLE = ("double",)
ALIAS_SPLIT = ("split",)
ALIAS_INSURANCE = (ITEMS[ItemId.Insurance].id, ITEMS[ItemId.Insurance].id_short_name)
ALIAS_HOTCARD = (ITEMS[ItemId.HotCard].id, ITEMS[ItemId.HotCard].id_short_name)

WIKI_DATA: Dict[Tuple[str, ...], str] = {
    ALIAS_BJ: BLACK_JACK_RULES,
    ALIAS_DOUBLE: DOUBLE_DESC,
    ALIAS_SPLIT: SPLIT_DESC,
    ALIAS_INSURANCE: INSURANCE_DESC,
    ALIAS_HOTCARD: HOTCARD_DESC,
}


def _normalize(s: str) -> str:
    return s.strip().lower()


def _lookup(term: str) -> str:
    q = _normalize(term)
    for keys, desc in WIKI_DATA.items():
        if q in (k.lower() for k in keys if k):
            return desc
    return f"‚ùå –¢–µ—Ä–º–∏–Ω ¬´{term}¬ª –Ω–µ –Ω–∞–π–¥–µ–Ω. –ü–æ–ø—Ä–æ–±—É–π –¥—Ä—É–≥–æ–π –≤–∞—Ä–∏–∞–Ω—Ç –∏–ª–∏ —Å–∏–Ω–æ–Ω–∏–º."


def _is_bj(term: str) -> bool:
    q = _normalize(term)
    return q in {k.lower() for k in ALIAS_BJ if k}


def _wiki_inline_kb() -> InlineKeyboardMarkup:
    return InlineKeyboardMarkup(
        [
            [
                InlineKeyboardButton(text="/wiki double", callback_data="wiki:double"),
                InlineKeyboardButton(text="/wiki split", callback_data="wiki:split"),
            ]
        ]
    )


async def wiki_command(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    if not context.args:
        await update.effective_chat.send_message("–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: /wiki <cmd>/<item_id>")
        return

    query = " ".join(context.args)
    text = _lookup(query)

    if _is_bj(query):
        await update.effective_chat.send_message(text, reply_markup=_wiki_inline_kb())
    else:
        await update.effective_chat.send_message(text)


async def wiki_inline_cb(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    q = update.callback_query
    await q.answer()
    term = q.data.split(":", 1)[1]  # "double" | "split"
    text = _lookup(term)
    await context.bot.send_message(chat_id=update.effective_chat.id, text=text)


def register_handlers(app):
    app.add_handler(CommandHandler(list(HandlerWiki), wiki_command))
    app.add_handler(
        CallbackQueryHandler(wiki_inline_cb, pattern=r"^wiki:(double|split)$")
    )
